<!DOCTYPE html>
<html lang="mr">
<head>
  <!-- Tailwind, ChartJS, etc. as before -->
</head>
<body class="...">
  <div class="glass max-w-7xl mx-auto p-6">
    <h1>तालुका योजना रँकिंग डॅशबोर्ड</h1>
    <div class="flex gap-4">
      <select id="schemeSelect" multiple></select>
      <select id="talukaSelect" multiple></select>
      <button id="applyBtn" class="btn">Apply Filters</button>
      <button id="resetBtn" class="btn hidden">Reset</button>
    </div>
    <div id="kpiSummary" class="grid ..."></div>
    <div class="grid grid-cols-3 gap-6">
      <div id="top3" class="kpi-card pill-top"></div>
      <div id="mid3" class="kpi-card pill-mid"></div>
      <div id="bot3" class="kpi-card pill-bottom"></div>
    </div>
    <canvas id="barChart"></canvas>
    <canvas id="donutChart"></canvas>
    <canvas id="horizontalBarChart"></canvas>
    <div class="table-scroll-container">
      <table id="fullTable"></table>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Fetch data using opensheet
fetch("https://opensheet.elk.sh/1y_EVqNg-reS3xV-Kn6cmTou7u_6kuyqykNdgdzXEMkE/Rank")
  .then(r => r.json())
  .then(rows => {
    // rows एक array of objects: first row header keys automatically parsed
    const headers = Object.keys(rows[0]);
    const data = rows.map((row, i) => ({ ...row, "_rowIndex": i + 1 }));
    // filters initialization
    const talukas = [...new Set(data.map(d => d["तालुका"]))];
    const schemes = headers.filter(h => h !== "तालुका" && h !== "अ.क्र.");
    // populate dropdowns
    const sSel = document.getElementById("schemeSelect");
    schemes.forEach(s => sSel.innerHTML += `<option value="${s}" selected>${s}</option>`);
    const tSel = document.getElementById("talukaSelect");
    talukas.forEach(t => tSel.innerHTML += `<option value="${t}" selected>${t}</option>`);
    // apply render
    document.getElementById("applyBtn").onclick = () => renderDashboard();
    document.getElementById("resetBtn").onclick = () => {
        [...sSel.options].forEach(o => o.selected = true);
        [...tSel.options].forEach(o => o.selected = true);
        renderDashboard();
    };
    renderDashboard();

    function renderDashboard(){
      const selSch = Array.from(sSel.selectedOptions).map(o => o.value);
      const selTal = Array.from(tSel.selectedOptions).map(o => o.value);
      const filtered = data.filter(d => selTal.includes(d["तालुका"]));
      // build KPI, charts, table...
      // implement logic: count frequency of numeric '1' per taluka across schemes: top3 etc.
      // average ranks per scheme: barChart; donut partition by top/mid/bottom groups; horizontal total score per taluka
      // Table rendering with sticky columns, search/filter, highlight selected
      // [Full code body to follow]
    }
  })
  .catch(err => { console.error(err); });
</script>
</body>
</html>
